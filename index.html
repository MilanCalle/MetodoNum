<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solucionador de Sistemas Lineales</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/plotly.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }
        .content {
            padding: 30px;
        }
        .problem-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .problem-section h2 {
            color: #667eea;
            margin-bottom: 15px;
        }
        .matrix-display {
            background: white;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 15px 0;
        }
        .methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .method-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .method-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        .method-card h3 {
            margin-bottom: 10px;
        }
        .results {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }
        .results.show {
            display: block;
        }
        .result-item {
            margin: 10px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .result-item h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        .solution-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #2e7d32;
        }
        #plot3d {
            width: 100%;
            height: 600px;
            margin-top: 20px;
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s;
        }
        .btn:hover {
            transform: scale(1.05);
        }
        .iterations {
            max-height: 300px;
            overflow-y: auto;
            background: white;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #667eea;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèóÔ∏è Solucionador de Sistemas Lineales</h1>
            <div class="subtitle">Problema de Canteras - M√©todos Num√©ricos</div>
        </div>
        
        <div class="content">
            <div class="problem-section">
                <h2>üìã Planteamiento del Problema</h2>
                <p><strong>Datos de las Canteras:</strong></p>
                <ul style="margin: 10px 0 10px 20px;">
                    <li>Cantera 1: 52% arena, 30% grano fino, 18% grano grueso</li>
                    <li>Cantera 2: 20% arena, 50% grano fino, 30% grano grueso</li>
                    <li>Cantera 3: 25% arena, 20% grano fino, 55% grano grueso</li>
                </ul>
                <p><strong>Requerimientos:</strong> 4800 m¬≥ arena, 5810 m¬≥ grano fino, 5690 m¬≥ grano grueso</p>
                
                <div class="matrix-display">
                    <strong>Sistema de Ecuaciones: A¬∑x = b</strong><br><br>
                    <pre>
‚îå                    ‚îê   ‚îå    ‚îê   ‚îå      ‚îê
‚îÇ 0.52  0.20  0.25  ‚îÇ   ‚îÇ x‚ÇÅ ‚îÇ   ‚îÇ 4800 ‚îÇ
‚îÇ 0.30  0.50  0.20  ‚îÇ ¬∑ ‚îÇ x‚ÇÇ ‚îÇ = ‚îÇ 5810 ‚îÇ
‚îÇ 0.18  0.30  0.55  ‚îÇ   ‚îÇ x‚ÇÉ ‚îÇ   ‚îÇ 5690 ‚îÇ
‚îî                    ‚îò   ‚îî    ‚îò   ‚îî      ‚îò
                    </pre>
                </div>
            </div>

            <h2 style="color: #667eea; margin-bottom: 20px;">üîß Selecciona un M√©todo de Soluci√≥n:</h2>
            
            <div class="methods">
                <div class="method-card" onclick="solveInverse()">
                    <h3>üìê M√©todo 1: Inv(A)¬∑b</h3>
                    <p>Soluci√≥n directa usando matriz inversa</p>
                </div>
                <div class="method-card" onclick="solveJacobi()">
                    <h3>üîÑ M√©todo 2: Jacobi</h3>
                    <p>M√©todo iterativo convergente</p>
                </div>
                <div class="method-card" onclick="solveLU()">
                    <h3>‚ö° M√©todo 3: Descomposici√≥n LU</h3>
                    <p>Factorizaci√≥n eficiente</p>
                </div>
            </div>

            <div style="text-align: center;">
                <button class="btn" onclick="solveAll()">üöÄ Resolver con Todos los M√©todos</button>
                <button class="btn" onclick="plot3DPlanes()">üìä Visualizar Planos en 3D</button>
            </div>

            <div id="results" class="results"></div>
            <div id="plot3d"></div>
        </div>
    </div>

    <script>
        // Datos del problema
        const A = [[0.52, 0.20, 0.25],
                   [0.30, 0.50, 0.20],
                   [0.18, 0.30, 0.55]];
        const b = [4800, 5810, 5690];

        function solveInverse() {
            const matA = math.matrix(A);
            const matB = math.matrix(b);
            const invA = math.inv(matA);
            const solution = math.multiply(invA, matB);
            
            let html = `
                <h2>‚úÖ Soluci√≥n por Inv(A)¬∑b</h2>
                <div class="result-item">
                    <h3>Matriz Inversa A‚Åª¬π:</h3>
                    <div class="matrix-display"><pre>${formatMatrix(invA.toArray())}</pre></div>
                </div>
                <div class="result-item">
                    <h3>Soluci√≥n:</h3>
                    ${formatSolution(solution.toArray())}
                </div>
                <div class="result-item">
                    <h3>Verificaci√≥n (A¬∑x):</h3>
                    ${formatVerification(solution.toArray())}
                </div>
            `;
            
            showResults(html);
        }

        function solveJacobi() {
            const maxIter = 50;
            const tol = 1e-6;
            let x = [0, 0, 0];
            let iterations = [];
            
            for (let k = 0; k < maxIter; k++) {
                let xNew = [...x];
                
                for (let i = 0; i < 3; i++) {
                    let sum = 0;
                    for (let j = 0; j < 3; j++) {
                        if (j !== i) sum += A[i][j] * x[j];
                    }
                    xNew[i] = (b[i] - sum) / A[i][i];
                }
                
                iterations.push({iter: k+1, x: [...xNew], error: math.norm(math.subtract(xNew, x))});
                
                if (math.norm(math.subtract(xNew, x)) < tol) {
                    x = xNew;
                    break;
                }
                x = xNew;
            }
            
            let html = `
                <h2>‚úÖ Soluci√≥n por M√©todo de Jacobi</h2>
                <div class="result-item">
                    <h3>Soluci√≥n Convergente:</h3>
                    ${formatSolution(x)}
                    <p><strong>Iteraciones:</strong> ${iterations.length}</p>
                    <p><strong>Error final:</strong> ${iterations[iterations.length-1].error.toExponential(4)}</p>
                </div>
                <div class="result-item">
                    <h3>Historial de Iteraciones:</h3>
                    <div class="iterations">
                        <table>
                            <tr><th>Iter</th><th>x‚ÇÅ</th><th>x‚ÇÇ</th><th>x‚ÇÉ</th><th>Error</th></tr>
                            ${iterations.map(it => `
                                <tr>
                                    <td>${it.iter}</td>
                                    <td>${it.x[0].toFixed(2)}</td>
                                    <td>${it.x[1].toFixed(2)}</td>
                                    <td>${it.x[2].toFixed(2)}</td>
                                    <td>${it.error.toExponential(2)}</td>
                                </tr>
                            `).join('')}
                        </table>
                    </div>
                </div>
                <div class="result-item">
                    <h3>Verificaci√≥n (A¬∑x):</h3>
                    ${formatVerification(x)}
                </div>
            `;
            
            showResults(html);
        }

        function solveLU() {
            const matA = math.matrix(A);
            const matB = math.matrix(b);
            const lu = math.lup(matA);
            const solution = math.lusolve(lu, matB);
            
            let html = `
                <h2>‚úÖ Soluci√≥n por Descomposici√≥n LU</h2>
                <div class="result-item">
                    <h3>Matriz L (Triangular Inferior):</h3>
                    <div class="matrix-display"><pre>${formatMatrix(lu.L.toArray())}</pre></div>
                </div>
                <div class="result-item">
                    <h3>Matriz U (Triangular Superior):</h3>
                    <div class="matrix-display"><pre>${formatMatrix(lu.U.toArray())}</pre></div>
                </div>
                <div class="result-item">
                    <h3>Soluci√≥n:</h3>
                    ${formatSolution(solution.toArray().flat())}
                </div>
                <div class="result-item">
                    <h3>Verificaci√≥n (A¬∑x):</h3>
                    ${formatVerification(solution.toArray().flat())}
                </div>
            `;
            
            showResults(html);
        }

        function solveAll() {
            const methods = ['Inv(A)¬∑b', 'Jacobi', 'LU'];
            const solutions = [];
            
            // Inv(A)¬∑b
            const invSol = math.multiply(math.inv(math.matrix(A)), math.matrix(b)).toArray();
            solutions.push(invSol);
            
            // Jacobi
            let x = [0, 0, 0];
            for (let k = 0; k < 50; k++) {
                let xNew = [...x];
                for (let i = 0; i < 3; i++) {
                    let sum = 0;
                    for (let j = 0; j < 3; j++) {
                        if (j !== i) sum += A[i][j] * x[j];
                    }
                    xNew[i] = (b[i] - sum) / A[i][i];
                }
                if (math.norm(math.subtract(xNew, x)) < 1e-6) {
                    x = xNew;
                    break;
                }
                x = xNew;
            }
            solutions.push(x);
            
            // LU
            const luSol = math.lusolve(math.lup(math.matrix(A)), math.matrix(b)).toArray().flat();
            solutions.push(luSol);
            
            let html = `
                <h2>‚úÖ Comparaci√≥n de Todos los M√©todos</h2>
                <div class="result-item">
                    <table>
                        <tr><th>M√©todo</th><th>x‚ÇÅ (Cantera 1)</th><th>x‚ÇÇ (Cantera 2)</th><th>x‚ÇÉ (Cantera 3)</th></tr>
                        ${methods.map((m, i) => `
                            <tr>
                                <td><strong>${m}</strong></td>
                                <td>${solutions[i][0].toFixed(2)} m¬≥</td>
                                <td>${solutions[i][1].toFixed(2)} m¬≥</td>
                                <td>${solutions[i][2].toFixed(2)} m¬≥</td>
                            </tr>
                        `).join('')}
                    </table>
                </div>
                <div class="result-item">
                    <h3>üìä Interpretaci√≥n de Resultados:</h3>
                    <p><strong>Cantera 1:</strong> ${solutions[0][0].toFixed(2)} m¬≥ de material</p>
                    <p><strong>Cantera 2:</strong> ${solutions[0][1].toFixed(2)} m¬≥ de material</p>
                    <p><strong>Cantera 3:</strong> ${solutions[0][2].toFixed(2)} m¬≥ de material</p>
                    <p><strong>Total:</strong> ${(solutions[0][0] + solutions[0][1] + solutions[0][2]).toFixed(2)} m¬≥</p>
                </div>
            `;
            
            showResults(html);
        }

        function plot3DPlanes() {
            // Crear malla para los planos
            const range = math.range(-2000, 20000, 500).toArray();
            const [x1Grid, x2Grid] = meshgrid(range, range);
            
            // Calcular x3 para cada plano
            // Plano 1: 0.52x1 + 0.20x2 + 0.25x3 = 4800 => x3 = (4800 - 0.52x1 - 0.20x2) / 0.25
            // Plano 2: 0.30x1 + 0.50x2 + 0.20x3 = 5810 => x3 = (5810 - 0.30x1 - 0.50x2) / 0.20
            // Plano 3: 0.18x1 + 0.30x2 + 0.55x3 = 5690 => x3 = (5690 - 0.18x1 - 0.30x2) / 0.55
            
            const x3_plane1 = x1Grid.map((row, i) => row.map((val, j) => 
                (4800 - 0.52 * val - 0.20 * x2Grid[i][j]) / 0.25
            ));
            
            const x3_plane2 = x1Grid.map((row, i) => row.map((val, j) => 
                (5810 - 0.30 * val - 0.50 * x2Grid[i][j]) / 0.20
            ));
            
            const x3_plane3 = x1Grid.map((row, i) => row.map((val, j) => 
                (5690 - 0.18 * val - 0.30 * x2Grid[i][j]) / 0.55
            ));
            
            // Soluci√≥n
            const sol = math.multiply(math.inv(math.matrix(A)), math.matrix(b)).toArray();
            
            const traces = [
                {
                    type: 'surface',
                    x: x1Grid,
                    y: x2Grid,
                    z: x3_plane1,
                    name: 'Plano 1 (Arena)',
                    colorscale: 'Reds',
                    opacity: 0.6,
                    showscale: false
                },
                {
                    type: 'surface',
                    x: x1Grid,
                    y: x2Grid,
                    z: x3_plane2,
                    name: 'Plano 2 (Grano Fino)',
                    colorscale: 'Blues',
                    opacity: 0.6,
                    showscale: false
                },
                {
                    type: 'surface',
                    x: x1Grid,
                    y: x2Grid,
                    z: x3_plane3,
                    name: 'Plano 3 (Grano Grueso)',
                    colorscale: 'Greens',
                    opacity: 0.6,
                    showscale: false
                },
                {
                    type: 'scatter3d',
                    x: [sol[0]],
                    y: [sol[1]],
                    z: [sol[2]],
                    mode: 'markers',
                    marker: {
                        size: 15,
                        color: 'gold',
                        symbol: 'diamond',
                        line: {color: 'black', width: 2}
                    },
                    name: 'Soluci√≥n'
                }
            ];
            
            const layout = {
                title: 'Visualizaci√≥n 3D de los Planos del Sistema',
                scene: {
                    xaxis: {title: 'x‚ÇÅ - Cantera 1 (m¬≥)'},
                    yaxis: {title: 'x‚ÇÇ - Cantera 2 (m¬≥)'},
                    zaxis: {title: 'x‚ÇÉ - Cantera 3 (m¬≥)'},
                    camera: {
                        eye: {x: 1.5, y: 1.5, z: 1.3}
                    }
                },
                showlegend: true
            };
            
            Plotly.newPlot('plot3d', traces, layout);
            document.getElementById('plot3d').scrollIntoView({ behavior: 'smooth' });
        }

        function meshgrid(x, y) {
            const xx = [];
            const yy = [];
            for (let i = 0; i < y.length; i++) {
                xx.push([...x]);
                yy.push(Array(x.length).fill(y[i]));
            }
            return [xx, yy];
        }

        function formatMatrix(matrix) {
            return matrix.map(row => 
                row.map(val => val.toFixed(4).padStart(10)).join(' ')
            ).join('\n');
        }

        function formatSolution(sol) {
            return `
                <p><strong>x‚ÇÅ (Cantera 1):</strong> <span class="solution-value">${sol[0].toFixed(2)} m¬≥</span></p>
                <p><strong>x‚ÇÇ (Cantera 2):</strong> <span class="solution-value">${sol[1].toFixed(2)} m¬≥</span></p>
                <p><strong>x‚ÇÉ (Cantera 3):</strong> <span class="solution-value">${sol[2].toFixed(2)} m¬≥</span></p>
            `;
        }

        function formatVerification(sol) {
            const result = [
                A[0][0]*sol[0] + A[0][1]*sol[1] + A[0][2]*sol[2],
                A[1][0]*sol[0] + A[1][1]*sol[1] + A[1][2]*sol[2],
                A[2][0]*sol[0] + A[2][1]*sol[1] + A[2][2]*sol[2]
            ];
            return `
                <p>Arena: ${result[0].toFixed(2)} ‚âà ${b[0]} ‚úì</p>
                <p>Grano Fino: ${result[1].toFixed(2)} ‚âà ${b[1]} ‚úì</p>
                <p>Grano Grueso: ${result[2].toFixed(2)} ‚âà ${b[2]} ‚úì</p>
            `;
        }

        function showResults(html) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = html;
            resultsDiv.className = 'results show';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
